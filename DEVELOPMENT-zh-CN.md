# CodeTok 开发指南

## 项目概述

CodeTok 是一个创新的 AI项目 和代码应用的分享平台。它基于 Next.js 构建，采用了 TypeScript 作为开发语言，并集成了多个 UI 组件库来提供丰富的用户界面体验。

## 项目架构

CodeTok 采用模块化架构设计，将不同的功能方面分离为独立的模块。这种方法提高了可维护性、可扩展性，并促进了开发者之间的协作。

### 核心功能模块

1. **核心框架模块**
   - 基于Next.js 15的App Router架构
   - UI组件系统（Shadcn UI + Tailwind CSS）
   - 主题系统（暗色/亮色模式）
   - 全局错误处理和布局

2. **国际化与本地化模块**
   - 多语言路由系统（[locale]动态路由）
   - 翻译资源管理
   - 语言检测与切换功能
   - 本地化内容配置

3. **用户认证与账户系统**
   - 登录/注册功能
   - OAuth集成（GitHub、Google）
   - 用户资料管理
   - 会话和权限控制

4. **内容发现与社交互动模块**
   - 推荐系统（为你推荐）
   - 内容发现功能（发现作品）
   - 关注系统（已关注）
   - 评论与互动功能

5. **项目管理与展示模块**
   - 项目详情展示
   - 项目创建与编辑
   - 代码展示与执行
   - 外部项目嵌入

6. **一键部署模块**
   - 多平台部署集成（Vercel、Netlify、GitHub Pages）
   - 部署模板系统
   - 环境变量管理
   - 部署状态跟踪

7. **数据存储与API模块**
   - 数据库集成与模型定义
   - RESTful API设计
   - 数据迁移与备份工具
   - 查询与过滤系统

8. **开发者工具模块**
   - 代码编辑器
   - GitHub导入工具
   - 文件上传系统
   - 环境配置工具

这种模块化的架构设计使得CodeTok能够同时满足内容平台和开发者工具平台的需求，各模块之间相互协作但又保持一定的独立性，便于维护和扩展。

## MVP 开发优先级

以下是 CodeTok 最小可行产品(MVP)版本的优先开发领域，按重要性排序：

### 1. 核心功能完善与稳定 (高优先级)

1. **项目浏览和展示系统**
   - 加强随机项目重定向功能的可靠性测试
   - 优化项目展示页面的性能，特别是对外部嵌入项目的处理
   - 实现项目过滤和分类功能，让用户能够按类型/标签浏览项目
   - **TikTok风格浏览体验**，支持上下导航和智能推荐
      - 下按钮/下滑手势：根据当前项目属性显示下一个推荐项目
      - 上按钮/上滑手势：利用浏览历史返回之前查看过的项目
      - 使用sessionStorage进行客户端历史记录跟踪和持久化
      - 服务端推荐API考虑项目类型、相似度和热度因素
   - **优化首页加载体验**，采用客户端重定向
      - 显示带有品牌元素的视觉加载指示器
      - 改进错误处理和备用机制
      - 消除开发控制台中的NEXT_REDIRECT错误

2. **用户身份验证系统**
   - 实现基本的用户注册/登录功能
   - 整合第三方认证(GitHub、Google)以简化用户注册流程
   - 设置用户权限和角色管理

3. **数据库稳定性**
   - 优化数据库查询和连接，确保生产环境的稳定性
   - 完善数据迁移脚本和备份/恢复机制
   - 确保数据库连接池配置适合生产环境负载

### 2. 用户交互功能 (中优先级)

1. **项目互动功能**
   - 实现点赞、收藏、分享功能
   - 添加项目评论系统
   - 项目浏览计数和热门项目展示

2. **上传和创建项目**
   - 优化项目上传流程，支持多种文件格式
   - 添加更多模板和示例项目
   - 实现基本的在线代码编辑功能

3. **用户个人资料**
   - 用户资料页面和设置
   - 用户项目收藏列表
   - 用户贡献历史记录

### 3. 扩展功能 (低优先级，MVP后阶段)

1. **社区功能**
   - 用户关注系统
   - 活动流和通知
   - 项目协作功能

2. **内容管理**
   - 管理员控制面板
   - 内容审核工具
   - 举报和内容政策执行

3. **高级功能**
   - AI辅助代码生成
   - 项目统计和分析
   - 集成测试和CI/CD支持

### 实施建议

在实现MVP时，重点关注：

1. **完成用户认证系统**
   - 这是最缺失的核心功能，对于用户互动和内容管理至关重要
   - 实现基本的注册/登录功能，集成Better Auth

2. **改进项目浏览体验**
   - 添加分类、标签和搜索功能
   - 实现项目列表页面，提供更多浏览选项而不仅是随机跳转
   - 优化项目页面加载性能，特别是外部嵌入项目

3. **增加基本互动功能**
   - 实现点赞和收藏功能
   - 添加简单的评论系统
   - 实现项目分享和社交媒体集成

## 技术栈

- **框架**:
  - Next.js 15 (App Router)
  - React 18.3.1
- **UI库**:
  - React 19 (Next.js)
  - React 18.3.1
- **开发语言**: TypeScript
- **样式**:
  - Tailwind CSS v4 (Next.js)
  - Tailwind CSS 3.4.4
- **组件库**:
  - Shadcn UI
  - MagicUI Design
  - Radix UI (Primitives)
- **构建工具**:
  - Vite 5.2.13
- **图标库**:
  - Lucide React 0.424.0
- **工具库**:
  - clsx - 用于构造类名字符串的工具
  - tailwind-merge - 合并Tailwind CSS类而不产生样式冲突
  - class-variance-authority - 类型安全的UI组件变体
- **包管理**: pnpm

### 后端与数据库

- **数据库**: Neon Database (Serverless PostgreSQL)
- **ORM**: Drizzle ORM
- **存储**: Vercel Blob Storage (用于文件上传和代码分享)
- **身份认证**: Better Auth
- **API**: Next.js API Routes + Next Safe Action
- **邮件服务**: Resend
- **支付处理**:
  - Stripe
  - Creem.io

### 国际化

- **i18n框架**: Next-intl

### 分析与AI

- **分析工具**:
  - Plausible Analytics
  - Google Analytics
- **AI集成**: Vercel AI SDK
- **内容管理**: Content Collections

### 数据展示

- **表格**: Tanstack Table

### 开发工具

- **AI IDE**: Trae
- **代码质量**:
  - ESLint
  - Prettier
  - TypeScript严格模式
- **Git工作流**:
  - 约定式提交
  - 分支开发
  - GitHub Actions CI/CD

## 目录结构

```
CodeTok/
├── app/                      # Next.js 15 App Router
│   ├── [locale]/            # 国际化路由
│   ├── api/                 # API路由
│   └── providers.tsx        # 全局提供者
├── components/              # React组件
│   ├── ui/                 # Shadcn UI组件
│   └── features/           # 功能组件
├── db/                      # 数据库Schema和客户端
│   ├── schema.ts           # Drizzle Schema
│   └── index.ts            # DB客户端
├── config/                  # 配置文件
├── i18n/                    # 国际化
│   ├── client.ts           # 客户端国际化
│   └── server.ts           # 服务端国际化
├── lib/                     # 工具函数
│   ├── auth.ts             # 认证逻辑
│   ├── actions.ts          # 服务器操作
│   └── stripe.ts           # 支付逻辑
├── messages/               # 翻译文件
├── public/                 # 静态资源
└── styles/                 # 全局样式
```

## 组件库

### Shadcn UI

Shadcn UI 是一套基于 Radix UI 和 Tailwind CSS 构建的无样式组件集合，提供了高度可定制的组件，用于构建现代化的用户界面。

组件位于 `src/components/ui` 目录，通过 `@/components/ui` 导入路径导出。

主要组件包括：

- Button, Input, Form 等基础组件
- Dialog, Sheet, Popover 等交互组件
- Table, DataTable 等数据展示组件

## 开发规范

### 核心原则

**始终遵循官方文档**: 在集成库、框架或API时，必须严格按照其官方文档作为首要参考标准进行开发。这确保了兼容性、正确的实现方式，并利用了技术创建者推荐的最佳实践。官方文档的优先级高于其他参考资料或之前的实现模式。

### 代码风格

- 使用 TypeScript 进行类型检查
- 遵循 ESLint 和 Prettier 配置的代码格式
- 模块化开发，每个功能模块应该有自己的目录

### 组件开发原则

1. **模块化**: 每个功能模块开发归档两份 README，一份英文文档，一份简体中文，总结功能、接口和使用方式
2. **小步快跑**: 每次只开发一个功能，代码遵循最佳实践，不搞黑科技
3. **及时提交**: 每完成一个节点提交一下 git 暂存
4. **完整测试**: 每个模块开发完成后，必须进行全面测试，包括组件测试、API测试、集成测试和跨浏览器测试，确保功能正常工作无误，所有测试通过后才能视为模块完成

### 命名规范

- 组件文件名: PascalCase (例如 `Button.tsx`)
- 工具函数文件名: camelCase (例如 `useMediaQuery.ts`)
- CSS 类名: kebab-case 或遵循 Tailwind CSS 约定

### 注释规范

- 组件文件顶部应有组件功能说明
- 复杂逻辑应有相应注释
- 公共 API 和接口应有完整文档注释
- 代码注释使用英文

### 国际化

- 界面文本使用国际化方案，不硬编码
- 支持中英文切换
- 国际化文件位于 `messages` 目录

### 包管理

- 统一使用 pnpm 进行包管理
- 添加新依赖时确保依赖版本锁定

### Git 提交规范

- 提交信息使用英文
- 提交信息格式: `<type>: <description>`
- 类型包括: feat(新功能), fix(修复), docs(文档), style(格式), refactor(重构), test(测试), chore(杂项)

## 本地开发

### 环境设置

1. 克隆仓库
2. 安装依赖: `pnpm install`
3. 运行开发服务器: `pnpm dev`

### 安装新组件

#### Shadcn UI 组件

```bash
pnpm dlx shadcn@latest add <component-name>
```