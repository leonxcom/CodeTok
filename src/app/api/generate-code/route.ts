import { NextRequest, NextResponse } from 'next/server';
import { codeGenerator } from '@/lib/ai/code-generator';
import { getModelById } from '@/lib/ai/models';
import { getModelClient } from '@/lib/ai/providers';
import { generateText } from 'ai';



export async function POST(request: NextRequest) {
  let requestData;
  
  try {
    requestData = await request.json();
    const { prompt, language = 'react', modelId, quickMode = false, conversationHistory = [] } = requestData;

    if (!prompt) {
      return NextResponse.json(
        { error: 'ËØ∑Êèê‰æõ‰ª£Á†ÅÁîüÊàêÈúÄÊ±Ç' },
        { status: 400 }
      );
    }

      // Â¶ÇÊûúÁî®Êà∑ÊòéÁ°ÆË¶ÅÊ±ÇÂø´ÈÄüÊ®°ÂºèÔºåÁõ¥Êé•‰ΩøÁî®Ê®°Êùø
  if (quickMode) {
    console.log('Áî®Êà∑ÈÄâÊã©Âø´ÈÄüÊ®°ÂºèÔºåËøîÂõûÊ®°Êùø‰ª£Á†Å');
    const exampleCode = await generateExampleCode(prompt, language);
    return NextResponse.json({
      ...exampleCode,
      isTemplate: true // Ê†áËÆ∞‰∏∫Ê®°Êùø
    });
  }

    // Ê≠£Â∏∏Ê®°ÂºèÂ§ÑÁêÜÂ§çÊùÇËØ∑Ê±Ç
    console.log('‰ΩøÁî®Ê≠£Â∏∏Ê®°ÂºèÂ§ÑÁêÜÂ§çÊùÇËØ∑Ê±ÇÔºåËØ∑ËÄêÂøÉÁ≠âÂæÖ...');
    
    try {
      // ÊûÑÂª∫ÂåÖÂê´ÂéÜÂè≤ÁöÑÂÆåÊï¥ÊèêÁ§∫
      let contextualPrompt = prompt;
      if (conversationHistory.length > 0) {
        const historyText = conversationHistory
          .slice(-4) // Âè™ÂèñÊúÄËøë4ËΩÆÂØπËØùÈÅøÂÖçËøáÈïø
          .map((msg: {role: string, content: string}) => `${msg.role}: ${msg.content}`)
          .join('\n\n');
        contextualPrompt = `Previous conversation:\n${historyText}\n\nNew request: ${prompt}`;
        console.log('üìù ‰ΩøÁî®ÂØπËØùÂéÜÂè≤ÔºåÊîØÊåÅÂ§öËΩÆ‰∫§‰∫í');
      }

      // ‰ºòÂÖà‰ΩøÁî®OpenRouterÁöÑÊõ¥Âø´Ê®°Âûã
      const preferredModels = [
        'deepseek/deepseek-chat',  // Êõ¥Âø´ÁöÑChatÊ®°ÂûãÔºå‰ª£ÊõøR1
        'openai/gpt-4o-mini',      // GPT-4o Mini‰Ωú‰∏∫Â§áÈÄâ
        'deepseek/deepseek-r1',    // R1‰Ωú‰∏∫ÊúÄÂêéÂ§áÈÄâ
      ];
      
      let selectedModel = null;
      for (const mid of preferredModels) {
        const candidateModel = getModelById(mid);
        if (candidateModel) {
          selectedModel = candidateModel;
          break;
        }
      }
      
      if (!selectedModel) {
        selectedModel = getModelById(modelId || 'deepseek/deepseek-chat');
      }
      
      const model = selectedModel;
      
      if (!model) {
        throw new Error(`Model ${modelId} not found`);
      }
      
      const aiModel = getModelClient(model, {});
      
      // ÊûÑÂª∫‰∏ìÈó®ÁöÑ‰ª£Á†ÅÁîüÊàêÊèêÁ§∫
      const codePrompt = `‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑ${language}ÂºÄÂèëËÄÖ„ÄÇËØ∑‰∏∫‰ª•‰∏ãÈúÄÊ±ÇÁîüÊàêÂÆåÊï¥ÁöÑ‰ª£Á†ÅÔºö

ÈúÄÊ±Ç: ${contextualPrompt}

ËØ∑ËøîÂõûÔºö
1. ÂÆåÊï¥ÁöÑ${language}‰ª£Á†ÅÂÆûÁé∞
2. ‰ª£Á†ÅÂäüËÉΩËØ¥Êòé

Ê†ºÂºèÔºö
\`\`\`${language === 'react' ? 'jsx' : language}
// ‰Ω†ÁöÑ‰ª£Á†Å
\`\`\`

ËØ¥Êòé: [‰ª£Á†ÅÂäüËÉΩËØ¥Êòé]`;

      const aiResult = await generateText({
        model: aiModel,
        prompt: codePrompt,
        maxTokens: 2000,
        temperature: 0.7,
      });
      
      // Ëß£Êûê‰ª£Á†ÅÂíåËØ¥Êòé
      const codeMatch = aiResult.text.match(/```(?:jsx|javascript|js|tsx|ts|python|html|css)?\n([\s\S]*?)\n```/);
      const code = codeMatch ? codeMatch[1].trim() : aiResult.text;
      
      const descMatch = aiResult.text.match(/ËØ¥Êòé:\s*(.*?)(?:\n|$)/);
      const description = descMatch ? descMatch[1].trim() : 'Áî±AIÁîüÊàêÁöÑ‰ª£Á†ÅÂÆûÁé∞';
      
      const result = {
        code,
        language,
        description,
        usage: {
          promptTokens: aiResult.usage?.promptTokens || 0,
          completionTokens: aiResult.usage?.completionTokens || 0,
          totalTokens: aiResult.usage?.totalTokens || 0,
        }
      };

      console.log('‚úÖ AI‰ª£Á†ÅÁîüÊàêÊàêÂäü');
      
      // Ê†ºÂºèÂåñÂìçÂ∫î‰ª•ÂåπÈÖçÂâçÁ´ØÊúüÊúõÁöÑÊ†ºÂºè
      const response = {
        title: `${language.toUpperCase()} - ${prompt}`,
        description: result.description,
        language: result.language,
        code: result.code,
        explanation: `üß† AI‰ª£Á†ÅÁîüÊàêÂÆåÊàêÔºÅÂü∫‰∫éÊÇ®ÁöÑÈúÄÊ±Ç"${prompt}"ÔºåÊàë‰∏∫ÊÇ®ÁîüÊàê‰∫ÜÊô∫ËÉΩÂÆöÂà∂ÁöÑ${language}‰ª£Á†ÅÂÆûÁé∞Ôºö\n\n${result.description}`,
        e2bUrl: `https://fragments.e2b.dev/?prompt=${encodeURIComponent(prompt)}`,
        usage: result.usage,
        isTemplate: false // Ê†áËÆ∞‰∏∫ÁúüÂÆûAIÁîüÊàê
      };
      
      return NextResponse.json(response);
      
    } catch (aiError) {
      console.error('‚ùå AIÁîüÊàêÂ§±Ë¥•Ôºå‰ΩøÁî®Â∫îÊÄ•Ê®°Êùø:', aiError);
      // AIÁîüÊàêÂ§±Ë¥•Êó∂ËøîÂõûÂ∫îÊÄ•Ê®°Êùø
      const exampleCode = await generateExampleCode(prompt, language);
      return NextResponse.json({
        ...exampleCode,
        isTemplate: true,
        explanation: `DeepSeek AIÊ≠£Âú®Â§ÑÁêÜÂ§ßÈáèËØ∑Ê±ÇÔºåÊöÇÊó∂Êó†Ê≥ïÁîüÊàêÂÆöÂà∂‰ª£Á†Å„ÄÇ‰∏∫ÊÇ®Êèê‰æõ‰∫Ü"${prompt}"ÁöÑÈ´òË¥®ÈáèÊ®°Êùø„ÄÇ

üí° ÊÇ®ÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ê≠§Ê®°ÊùøÔºåÊàñÁ®çÂêéÈáçËØïËé∑ÂèñAIÊ∑±Â∫¶ÂÆöÂà∂ÁöÑ‰ª£Á†Å„ÄÇ`
      });
    }
    
  } catch (error) {
    console.error('‰ª£Á†ÅÁîüÊàêÂ§±Ë¥•:', error);
    
    const errorPrompt = requestData?.prompt || 'ÊÇ®ÁöÑËØ∑Ê±Ç';
    
    // Â¶ÇÊûúAIÁîüÊàêÂ§±Ë¥•ÔºåËøîÂõû‰∏Ä‰∏™Á§∫‰æã
    if (requestData?.prompt) {
      const exampleCode = await generateExampleCode(requestData.prompt, requestData.language || 'react');
      return NextResponse.json({
        ...exampleCode,
        isTemplate: true, // Ê†áËÆ∞‰∏∫Â∫îÊÄ•Ê®°Êùø
        explanation: `DeepSeek AIÊöÇÊó∂ÁπÅÂøôÔºå‰∏∫ÊÇ®Êèê‰æõ‰∫Ü"${requestData.prompt}"ÁöÑÂü∫Á°ÄÊ®°Êùø„ÄÇ

üí° ÊÇ®ÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ê≠§Ê®°ÊùøÔºåÊàñÁ®çÂêéÁÇπÂáª"AIÊ∑±Â∫¶ÁîüÊàê"Ëé∑ÂèñÊõ¥‰∏™ÊÄßÂåñÁöÑ‰ª£Á†Å„ÄÇ`
      });
    }
    
    return NextResponse.json(
      { 
        error: '‰ª£Á†ÅÁîüÊàêÂ§±Ë¥•', 
        message: error instanceof Error ? error.message : 'Êú™Áü•ÈîôËØØ',
        explanation: `Êä±Ê≠âÔºåÊöÇÊó∂Êó†Ê≥ï‰∏∫"${errorPrompt}"ÁîüÊàê‰ª£Á†Å„ÄÇËØ∑Ê£ÄÊü•Ôºö

‚Ä¢ APIÂØÜÈí•ÊòØÂê¶Ê≠£Á°ÆÈÖçÁΩÆ
‚Ä¢ ÁΩëÁªúËøûÊé•ÊòØÂê¶Ê≠£Â∏∏
‚Ä¢ Â∞ùËØïÊõ¥ÂÖ∑‰ΩìÁöÑÊèèËø∞ÔºåÊØîÂ¶ÇÔºö
  - Â¶Ç‰ΩïÁî®ReactÂàõÂª∫‰∏Ä‰∏™ÂæÖÂäû‰∫ãÈ°πÂàóË°®Ôºü
  - Âà∂‰Ωú‰∏Ä‰∏™CSSÂä®ÁîªÊåâÈíÆ
  - Áî®PythonÂÜô‰∏Ä‰∏™ËÆ°ÁÆóÂô®ÂáΩÊï∞
  - ÂàõÂª∫‰∏Ä‰∏™Vue.jsËÆ°Êï∞Âô®ÁªÑ‰ª∂`
      },
      { status: 500 }
    );
  }
}

// ÁîüÊàêÁ§∫‰æã‰ª£Á†ÅÁöÑÂáΩÊï∞
async function generateExampleCode(prompt: string, language: string) {
  const templates = {
    react: {
      button: `import React from 'react';

const Button = ({ children, onClick, variant = 'primary' }) => {
  const baseStyles = 'px-4 py-2 rounded-lg font-medium transition-colors';
  const variants = {
    primary: 'bg-blue-600 text-white hover:bg-blue-700',
    secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300'
  };

  return (
    <button 
      className={\`\${baseStyles} \${variants[variant]}\`}
      onClick={onClick}
    >
      {children}
    </button>
  );
};

export default Button;`,
      counter: `import React, { useState } from 'react';

const Counter = () => {
  const [count, setCount] = useState(0);

  return (
    <div className="flex flex-col items-center p-8">
      <h1 className="text-4xl font-bold mb-8">{count}</h1>
      <div className="flex gap-4">
        <button 
          onClick={() => setCount(count - 1)}
          className="px-4 py-2 bg-red-500 text-white rounded"
        >
          -
        </button>
        <button 
          onClick={() => setCount(0)}
          className="px-4 py-2 bg-gray-500 text-white rounded"
        >
          ÈáçÁΩÆ
        </button>
        <button 
          onClick={() => setCount(count + 1)}
          className="px-4 py-2 bg-green-500 text-white rounded"
        >
          +
        </button>
      </div>
    </div>
  );
};

export default Counter;`
    },
    mcp: {
      server: `#!/usr/bin/env node
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import {
  CallToolRequestSchema,
  ErrorCode,
  ListResourcesRequestSchema,
  ListToolsRequestSchema,
  McpError,
  ReadResourceRequestSchema,
} from '@modelcontextprotocol/sdk/types.js';

class MyMCPServer {
  private server: Server;

  constructor() {
    this.server = new Server(
      {
        name: 'my-mcp-server',
        version: '0.1.0',
      },
      {
        capabilities: {
          resources: {},
          tools: {},
        },
      }
    );

    this.setupToolHandlers();
    this.setupResourceHandlers();
  }

  private setupToolHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () => {
      return {
        tools: [
          {
            name: 'get_current_time',
            description: 'Get the current date and time',
            inputSchema: {
              type: 'object',
              properties: {
                format: {
                  type: 'string',
                  description: 'Time format (iso, locale, unix)',
                  enum: ['iso', 'locale', 'unix'],
                  default: 'iso'
                }
              }
            },
          },
          {
            name: 'calculate',
            description: 'Perform basic mathematical calculations',
            inputSchema: {
              type: 'object',
              properties: {
                operation: {
                  type: 'string',
                  description: 'Math operation to perform',
                  enum: ['add', 'subtract', 'multiply', 'divide']
                },
                a: {
                  type: 'number',
                  description: 'First number'
                },
                b: {
                  type: 'number',
                  description: 'Second number'
                }
              },
              required: ['operation', 'a', 'b']
            },
          },
        ],
      };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) => {
      const { name, arguments: args } = request.params;

      try {
        if (name === 'get_current_time') {
          const format = args?.format || 'iso';
          const now = new Date();
          
          let timeString;
          switch (format) {
            case 'iso':
              timeString = now.toISOString();
              break;
            case 'locale':
              timeString = now.toLocaleString();
              break;
            case 'unix':
              timeString = Math.floor(now.getTime() / 1000).toString();
              break;
            default:
              timeString = now.toISOString();
          }

          return {
            content: [
              {
                type: 'text',
                text: \`Current time (\${format}): \${timeString}\`,
              },
            ],
          };
        }

        if (name === 'calculate') {
          const { operation, a, b } = args as { operation: string; a: number; b: number };
          
          let result: number;
          switch (operation) {
            case 'add':
              result = a + b;
              break;
            case 'subtract':
              result = a - b;
              break;
            case 'multiply':
              result = a * b;
              break;
            case 'divide':
              if (b === 0) {
                throw new Error('Division by zero is not allowed');
              }
              result = a / b;
              break;
            default:
              throw new Error(\`Unknown operation: \${operation}\`);
          }

          return {
            content: [
              {
                type: 'text',
                text: \`\${a} \${operation} \${b} = \${result}\`,
              },
            ],
          };
        }

        throw new McpError(ErrorCode.MethodNotFound, \`Unknown tool: \${name}\`);
      } catch (error) {
        const errorMessage = error instanceof Error ? error.message : 'Unknown error';
        throw new McpError(ErrorCode.InternalError, \`Tool execution failed: \${errorMessage}\`);
      }
    });
  }

  private setupResourceHandlers() {
    this.server.setRequestHandler(ListResourcesRequestSchema, async () => {
      return {
        resources: [
          {
            uri: 'config://settings',
            mimeType: 'application/json',
            name: 'Server Configuration',
            description: 'Current server configuration and settings',
          },
          {
            uri: 'status://health',
            mimeType: 'text/plain',
            name: 'Health Status',
            description: 'Server health and status information',
          },
        ],
      };
    });

    this.server.setRequestHandler(ReadResourceRequestSchema, async (request) => {
      const { uri } = request.params;

      if (uri === 'config://settings') {
        const config = {
          serverName: 'my-mcp-server',
          version: '0.1.0',
          capabilities: ['tools', 'resources'],
          timestamp: new Date().toISOString(),
        };

        return {
          contents: [
            {
              uri,
              mimeType: 'application/json',
              text: JSON.stringify(config, null, 2),
            },
          ],
        };
      }

      if (uri === 'status://health') {
        const status = \`Server Status: Healthy
Uptime: \${process.uptime()} seconds
Memory Usage: \${Math.round(process.memoryUsage().heapUsed / 1024 / 1024)} MB
Node Version: \${process.version}\`;

        return {
          contents: [
            {
              uri,
              mimeType: 'text/plain',
              text: status,
            },
          ],
        };
      }

      throw new McpError(ErrorCode.InvalidRequest, \`Unknown resource: \${uri}\`);
    });
  }

  async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error('MCP server running on stdio');
  }
}

const server = new MyMCPServer();
server.run().catch(console.error);

/* 
ÈúÄË¶ÅÁöÑ package.json ÈÖçÁΩÆ:
{
  "name": "my-mcp-server",
  "version": "0.1.0",
  "type": "module",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "build": "tsc",
    "dev": "tsc --watch"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^0.5.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "typescript": "^5.0.0"
  }
}

ÂÆâË£Ö‰æùËµñ: npm install @modelcontextprotocol/sdk
ËøêË°åÊúçÂä°: npm start
*/`
    }
  };

  // Ê£ÄÊµãËØ∑Ê±ÇÁ±ªÂûãÂπ∂ËøîÂõûÁõ∏Â∫îÊ®°Êùø
  const lowerPrompt = prompt.toLowerCase();
  if (lowerPrompt.includes('ÊåâÈíÆ') || lowerPrompt.includes('button')) {
    return {
      title: `${language.toUpperCase()} - ${prompt}`,
      description: '‰∏Ä‰∏™ÂèØÈáçÁî®ÁöÑReactÊåâÈíÆÁªÑ‰ª∂',
      language,
      code: templates.react.button,
      explanation: `‚ö° Âø´ÈÄüÊ®°ÊùøÁîüÊàêÂÆåÊàêÔºÅÂü∫‰∫é"${prompt}"‰∏∫ÊÇ®Êèê‰æõ‰∫ÜËøô‰∏™È´òË¥®ÈáèÁöÑReactÊåâÈíÆÁªÑ‰ª∂„ÄÇ

üí° ËøôÊòØÁ≤æÂøÉËÆæËÆ°ÁöÑÊ®°Êùø‰ª£Á†ÅÔºåÂèØÁõ¥Êé•‰ΩøÁî®„ÄÇÂ¶ÇÈúÄAIÊ∑±Â∫¶ÂÆöÂà∂ÔºåËØ∑ÁÇπÂáª"AIÊ∑±Â∫¶ÁîüÊàê"„ÄÇ`,
      e2bUrl: `https://fragments.e2b.dev/?prompt=${encodeURIComponent(prompt)}`,
      usage: { promptTokens: 50, completionTokens: 200, totalTokens: 250 }
    };
  }
  
  if (lowerPrompt.includes('ËÆ°Êï∞') || lowerPrompt.includes('counter')) {
    return {
      title: `${language.toUpperCase()} - ${prompt}`,
      description: '‰∏Ä‰∏™ReactËÆ°Êï∞Âô®ÁªÑ‰ª∂',
      language,
      code: templates.react.counter,
      explanation: `‚ö° Âø´ÈÄüÊ®°ÊùøÁîüÊàêÂÆåÊàêÔºÅÂü∫‰∫é"${prompt}"‰∏∫ÊÇ®Êèê‰æõ‰∫ÜËøô‰∏™ÂäüËÉΩÂÆåÊï¥ÁöÑReactËÆ°Êï∞Âô®ÁªÑ‰ª∂„ÄÇ

üí° ÂåÖÂê´Â¢ûÂáè„ÄÅÈáçÁΩÆÂäüËÉΩÂíåÁæéËßÇÊ†∑Âºè„ÄÇÂ¶ÇÈúÄAIÊ∑±Â∫¶ÂÆöÂà∂ÔºåËØ∑ÁÇπÂáª"AIÊ∑±Â∫¶ÁîüÊàê"„ÄÇ`,
      e2bUrl: `https://fragments.e2b.dev/?prompt=${encodeURIComponent(prompt)}`,
      usage: { promptTokens: 50, completionTokens: 300, totalTokens: 350 }
    };
  }

  if (lowerPrompt.includes('mcp') || lowerPrompt.includes('model context protocol') || lowerPrompt.includes('mcpÊúçÂä°') || lowerPrompt.includes('mcp server')) {
    return {
      title: `TypeScript - ${prompt}`,
      description: '‰∏Ä‰∏™ÂÆåÊï¥ÁöÑMCP (Model Context Protocol) ÊúçÂä°Âô®',
      language: 'typescript',
      code: templates.mcp.server,
      explanation: `‚ö° Âø´ÈÄüÊ®°ÊùøÁîüÊàêÂÆåÊàêÔºÅÂü∫‰∫é"${prompt}"‰∏∫ÊÇ®Êèê‰æõ‰∫ÜÂÆåÊï¥ÁöÑMCPÊúçÂä°Âô®Ê®°Êùø„ÄÇ

üí° Ëøô‰∏™MCPÊúçÂä°Âô®ÂåÖÂê´Ôºö
‚Ä¢ üîß Â∑•ÂÖ∑Â§ÑÁêÜÂô®ÔºàÊó∂Èó¥Ëé∑Âèñ„ÄÅËÆ°ÁÆóÂô®Ôºâ
‚Ä¢ üìö ËµÑÊ∫êÂ§ÑÁêÜÂô®ÔºàÈÖçÁΩÆ„ÄÅÂÅ•Â∫∑Áä∂ÊÄÅÔºâ
‚Ä¢ üöÄ Ê†áÂáÜMCPÂçèËÆÆÂÆûÁé∞
‚Ä¢ üì¶ ÂèØÁõ¥Êé•‰∏éClaude DesktopÁ≠âÂÆ¢Êà∑Á´ØÈõÜÊàê

Â¶ÇÈúÄAIÊ∑±Â∫¶ÂÆöÂà∂ÔºåËØ∑ÁÇπÂáª"AIÊ∑±Â∫¶ÁîüÊàê"„ÄÇ`,
      e2bUrl: `https://fragments.e2b.dev/?prompt=${encodeURIComponent(prompt)}`,
      usage: { promptTokens: 60, completionTokens: 800, totalTokens: 860 }
    };
  }

  // ÈªòËÆ§ËøîÂõû‰∏Ä‰∏™Âü∫Êú¨ÁöÑReactÁªÑ‰ª∂
  return {
    title: `${language.toUpperCase()} - ${prompt}`,
    description: 'Âü∫Êú¨ReactÁªÑ‰ª∂Ê®°Êùø',
    language,
    code: `import React from 'react';

const MyComponent = () => {
  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">${prompt}</h1>
      <p>ËøôÊòØ‰∏Ä‰∏™Âü∫‰∫éÊÇ®ÁöÑÈúÄÊ±ÇÁîüÊàêÁöÑÁªÑ‰ª∂Ê®°Êùø„ÄÇ</p>
    </div>
  );
};

export default MyComponent;`,
    explanation: `‚ö° Âø´ÈÄüÊ®°ÊùøÁîüÊàêÂÆåÊàêÔºÅÂü∫‰∫é"${prompt}"‰∏∫ÊÇ®Êèê‰æõ‰∫ÜÂü∫Á°ÄReactÁªÑ‰ª∂ÁªìÊûÑ„ÄÇ

üí° ËøôÊòØÈÄöÁî®Ê®°ÊùøÔºåÂèØ‰Ωú‰∏∫Ëµ∑ÁÇπ„ÄÇÂ¶ÇÈúÄAIÊ∑±Â∫¶ÂÆöÂà∂ÔºåËØ∑ÁÇπÂáª"AIÊ∑±Â∫¶ÁîüÊàê"Ëé∑ÂèñÊõ¥‰∏™ÊÄßÂåñÁöÑÂÆûÁé∞„ÄÇ`,
    e2bUrl: `https://fragments.e2b.dev/?prompt=${encodeURIComponent(prompt)}`,
    usage: { promptTokens: 30, completionTokens: 150, totalTokens: 180 }
  };
}

 